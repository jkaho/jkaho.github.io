"use strict";function t(){return(t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function e(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,r(t,e)}function n(t){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function o(t,e,n){return(o=i()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var o=new(Function.bind.apply(t,i));return n&&r(o,n.prototype),o}).apply(null,arguments)}function s(t){var e="function"==typeof Map?new Map:void 0;return(s=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return o(t,arguments,n(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),r(i,t)})(t)}Object.defineProperty(exports,"__esModule",{value:!0}),"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var u,c=function(){return"undefined"==typeof window},a=c()?null:null===(u=document.currentScript)||void 0===u?void 0:u.src,l="";a?l="(via "+new URL(a).host+")":c()&&(l="(SSR)");var p,f=["sajari-sdk-js/2.0.0-rc.2",l].filter(Boolean).join(" "),h=function(){function t(){this.events={}}var e=t.prototype;return e.emit=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.events["*"]&&this.events["*"].forEach((function(e){return e.apply(void 0,[t].concat(n))})),this.events[t]&&this.events[t].forEach((function(t){return t.apply(void 0,n)}))},e.on=function(t,e){var n=this;return this.events[t]||(this.events[t]=[]),this.events[t].push(e),function(){n.events[t]=n.events[t].filter((function(t){return t!==e}))}},t}(),v=function(t){function n(e){var n;return(n=t.call(this,e)||this).type="CONNECTION",n}return e(n,t),n}(s(Error)),d=function(t){function n(e,n,r){var i;return(i=t.call(this,n)||this).statusCode=e,i.error=r,i}return e(n,t),n}(s(Error)),y=function(){function t(t,e,n,r,i){if(void 0===n&&(n=(c()?"https:":"")+"//jsonapi.sajari.net"),this.userAgent="",!c()&&[r,i].some(Boolean))throw new Error("key/secret authorization is only supported for server-side rendering.");this.project=t,this.collection=e,this.endpoint=n,this.key=r,this.secret=i,this.interactionConsume=this.interactionConsume.bind(this)}var e=t.prototype;return e.call=function(t,e,n){try{if(!c()&&!navigator.onLine)throw new v("Search request failed due to a network error. Please check your network connection.");var r={project:[this.project],collection:[this.collection],"user-agent":[[f,this.userAgent].filter(Boolean).join(" ")]};return c()&&[this.key,this.secret].every(Boolean)&&Object.assign(r,{authorization:["keysecret "+this.key+" "+this.secret]}),Promise.resolve(fetch(""+this.endpoint+t,{signal:n,method:"POST",headers:{Accept:"application/json","Content-Type":"text/plain"},body:JSON.stringify({metadata:r,request:e})})).then((function(t){function e(e){return Promise.resolve(t.json())}var n=function(){if(200!==t.status){var e=function(){if(403===t.status)throw new d(t.status,"This domain is not authorized to make this search request.",new Error(n));throw new d(t.status,"Search request failed due to a configuration error.",new Error(n))},n=t.statusText,r=function(e,r){try{var i=Promise.resolve(t.json()).then((function(t){n=t.message}))}catch(t){return}return i&&i.then?i.then(void 0,(function(){})):i}();return r&&r.then?r.then(e):e()}}();return n&&n.then?n.then(e):e()}))}catch(t){return Promise.reject(t)}},e.pipeline=function(t,e){return new m(this,t,e)},e.interactionConsume=function(t,e,n,r){void 0===r&&(r={});try{return Promise.resolve(this.call("/sajari.interaction.v2.Interaction/ConsumeToken",{token:t,identifier:e,weight:n,data:r}))}catch(t){return Promise.reject(t)}},t}();(p=exports.PipelineType||(exports.PipelineType={}))[p.Query=1]="Query",p[p.Record=2]="Record";var g,m=function(n){function r(t,e,r){var i;return(i=n.call(this)||this).client=t,i.identifier={name:e,version:r},i}return e(r,n),r.prototype.search=function(e,n){try{var r={type:exports.TrackingType.None};return void 0!==n&&(r=t({query_id:n.queryID},function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)e.indexOf(n=o[r])>=0||(i[n]=t[n]);return i}(n,["queryID"]))),this.emit("search-sent",e),Promise.resolve(this.client.call("/sajari.api.pipeline.v1.Query/Search",{pipeline:this.identifier,tracking:r,values:e})).then((function(e){var n,r,i,o,s,u=Object.entries((null===(n=e.searchResponse)||void 0===n?void 0:n.aggregates)||{}).map((function(t){var e,n,r=t[0],i=t[1];if("metric"in i){var o=r.split(".");return{type:o[0],key:o[1],value:i.metric.value}}return"count"in i?{type:"count",key:r.replace(/^count./,""),value:i.count.counts}:"buckets"in i?{type:"count",key:"buckets",value:Object.values(null!==(e=null===(n=i.buckets)||void 0===n?void 0:n.buckets)&&void 0!==e?e:{}).reduce((function(t,e){var n;return Object.assign(t,((n={})[e.name]=e.count,n))}),{})}:{key:r,value:i}})).reduce((function(t,e){return void 0===e.type?(console.debug(e),t):(void 0===t[e.key]&&(t[e.key]={}),t[e.key][e.type]=e.value,t)}),{}),c=Object.entries((null===(r=e.searchResponse)||void 0===r?void 0:r.aggregateFilters)||{}).map((function(t){var e,n,r=t[0],i=t[1];if("metric"in i){var o=r.split(".");return{type:o[0],key:o[1],value:i.metric.value}}return"count"in i?{type:"count",key:r.replace(/^count./,""),value:i.count.counts}:"buckets"in i?{type:"count",key:"buckets",value:Object.values(null!==(e=null===(n=i.buckets)||void 0===n?void 0:n.buckets)&&void 0!==e?e:{}).reduce((function(t,e){var n;return Object.assign(t,((n={})[e.name]=e.count,n))}),{})}:{key:r,value:i}})).reduce((function(t,e){return void 0===e.type?(console.debug(e),t):(void 0===t[e.key]&&(t[e.key]={}),t[e.key][e.type]=e.value,t)}),{}),a=((null===(i=e.searchResponse)||void 0===i?void 0:i.results)||[]).map((function(n,r){var i=n.indexScore,o=n.score,s=n.values,u=void 0,c=(e.tokens||[])[r];return void 0!==c&&("click"in c?u={click:k+c.click.token}:"pos"in c?u=t({},c):"posNeg"in c&&(u={pos:c.posNeg.pos,neg:c.posNeg.neg})),{indexScore:i,score:o,values:b(s),token:u}}));return[{time:parseFloat((null===(o=e.searchResponse)||void 0===o?void 0:o.time)||"0.0"),totalResults:parseInt((null===(s=e.searchResponse)||void 0===s?void 0:s.totalResults)||"0",10),results:a,aggregates:u,aggregateFilters:c},e.values||{}]}))}catch(t){return Promise.reject(t)}},r}(h),k="https://re.sajari.com/token/";function b(t){var e={};return Object.keys(t).forEach((function(n){var r,i="single"in(r=t[n])?r.single:"repeated"in r?r.repeated.values:null;null!==i&&(e[n]=i)})),e}(g=exports.TrackingType||(exports.TrackingType={})).None="NONE",g.Click="CLICK",g.PosNeg="POS_NEG";var j=function(t){function n(e,n,r){var i;return(i=t.call(this)||this).queryID="",i.sequence=0,i.type=e,i.field=n,i.data=function(t){if("undefined"==typeof window)return{};var e=document.cookie.split(";").filter((function(t){return t.includes("_ga")||t.includes("sjID")})).map((function(t){return t.split("=")})).reduce((function(t,e){var n=e[0],r=e[1];return"_ga"===n?(t.ga=r,t):(t[n]=r,t)}),{});return void 0===t?e:(Object.entries(e).forEach((function(e){t[e[0]]=e[1]})),t)}(r),i}e(n,t);var r=n.prototype;return r.next=function(t){return""===this.queryID?(this.queryID=function(t){void 0===t&&(t=16);for(var e="",n=0;n<t;n++)e+="abcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(36*Math.random()));return e}(),this.sequence=0):this.sequence++,{type:this.type,queryID:this.queryID,sequence:this.sequence,field:this.field,data:this.data}},r.reset=function(){this.emit("tracking-reset"),this.queryID="",this.sequence=0},n}(h),O=function(){function t(t,e){this.textParam=t,this.session=e,this.lastQuery=""}var e=t.prototype;return e.next=function(t){var e=t[this.textParam];if(void 0===e)return this.reset(),this.session.next(t);var n=this.lastQuery.substr(0,Math.min(e.length,3));return(e.substr(0,n.length)!==n||this.lastQuery.length>0&&0===e.length)&&this.reset(),this.lastQuery=e,this.session.next(t)},e.reset=function(){this.session.reset()},t}(),E=function(n){function r(t,e,r,i){var o;return void 0===e&&(e=[]),void 0===r&&(r=!1),void 0===i&&(i="OR"),(o=n.call(this)||this).options=t,o.active=e,o.multi=r,o.joinOp=i,o}e(r,n);var i=r.prototype;return i.set=function(t,e){if(void 0===e&&(e=!0),this.multi)return this.active=e&&-1===this.active.indexOf(t)?this.active.concat(t):this.active.filter((function(e){return e!==t})),void this.emit("selection-updated",[].concat(this.active));this.active=e?[t]:[],this.emit("selection-updated",[].concat(this.active))},i.isActive=function(t){return-1!==this.active.indexOf(t)},i.get=function(){return[].concat(this.active)},i.updateOptions=function(e){var n=this;Object.keys(e).forEach((function(t){var r=e[t];if(void 0===r)return delete n.options[t],void(n.active=n.active.filter((function(e){return e!==t})));n.options[t]=r})),this.emit("options-updated",t({},this.options))},i.getOptions=function(){return t({},this.options)},i.filter=function(){var t=this,e=this.active.map((function(e){var n=t.options[e];return"function"==typeof n&&(n=n()),""!==n&&(n="("+n+")"),n})).filter(Boolean);switch(e.length){case 0:return"";case 1:return e[0];default:return e.join(" "+this.joinOp+" ")}},r}(h),x=function(t){function n(e){var n;return void 0===e&&(e={}),(n=t.call(this)||this).internal=e,n}e(n,t);var r=n.prototype;return r._internalUpdate=function(t){var e=this;Object.keys(t).forEach((function(n){var r=t[n];void 0===r?delete e.internal[n]:e.internal[n]=r}))},r.update=function(t){var e=this;this._internalUpdate(t),this.emit("values-changed",t,(function(t){return e._internalUpdate(t)}))},r.get=function(){var t={};return Object.entries(this.internal).forEach((function(e){var n=e[1];t[e[0]]="function"==typeof n?n():Array.isArray(n)?n.join(","):""+n})),t},n}(h);exports.Client=y,exports.DefaultSession=j,exports.EVENT_OPTIONS_UPDATED="options-updated",exports.EVENT_SEARCH_SENT="search-sent",exports.EVENT_SELECTION_UPDATED="selection-updated",exports.EVENT_TRACKING_RESET="tracking-reset",exports.EVENT_VALUES_UPDATED="values-changed",exports.EventEmitter=h,exports.Filter=E,exports.InteractiveSession=O,exports.NetworkError=v,exports.RequestError=d,exports.Values=x;
//# sourceMappingURL=sajarisdk.cjs.production.min.js.map
